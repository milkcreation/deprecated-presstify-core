!function(e,t,i){var o=e.valHooks.div;e.valHooks.div={get:function(t){return e(t).tiFyFieldsAjaxSelect("instance")?e(t).data("value"):o&&o.get&&o.get(t)||void 0},set:function(t,i){if(!e(t).tiFyFieldsAjaxSelect("instance"))return o&&o.set&&o.set(t,i)||void 0;e(t).data("value",i)}},e.widget("tify.tiFyFieldsAjaxSelect",{options:{disable:!1,placement:"clever",viewport:{selector:"body",delta:{top:0,left:0},adminbar:!0}},_create:function(){this.instance=this,this.el=this.element,e.extend(this.options,e.parseJSON(decodeURIComponent(this.el.data("options")))),this.handler=e(".tiFyCoreFields-ajaxSelectHandler",this.el),this.controller=e(".tiFyCoreFields-ajaxSelectController",this.el),this.options.disabled?this._disable():this._enable();var t=e(".tiFyCoreFields-ajaxSelectPicker",this.el);this.picker=t.clone(),t.remove(),this.items=e(".tiFyCoreFields-ajaxSelectOption",this.picker),this.append=e(this.options.viewport.selector),e(this.append).append(this.picker),this._initEvents()},_initEvents:function(){var t=this;e("html, body").click(function(e){t.controller.removeClass("tiFyCoreFields-ajaxSelectController--open"),t._hidePicker()}),t.items.each(function(){e(this).on("click",function(i){i.stopPropagation(),t.controller.html(e(this).html()),e("option:eq("+e(this).index()+")",t.handler).prop("selected",!0).change(),t.controller.removeClass("tiFyCoreFields-ajaxSelectController--open"),t._hidePicker()})}),t.handler.on("change",function(i){t.el.val(e(this).val()),t.el.trigger("change.tify_fields.ajax_select")})},_disable:function(){this.handler.prop("disabled",!0),this.controller.off("click.tify_fields.ajax_select."+this.instance.uuid).addClass("tiFyCoreFields-ajaxSelectController--disabled")},_enable:function(){var t=this;t.handler.prop("disabled",!1),t.controller.on("click.tify_fields.ajax_select."+t.instance.uuid,function(i){i.stopPropagation(),e(this).hasClass("tiFyCoreFields-ajaxSelectController--open")?(e(this).removeClass("tiFyCoreFields-ajaxSelectController--open"),t._hidePicker()):(e(this).addClass("tiFyCoreFields-ajaxSelectController--open"),t._showPicker())}).removeClass("tiFyCoreFields-ajaxSelectController--disabled")},_showPicker:function(){var t=this,o=t._getPickerOffset();t.picker.css(o).addClass("tiFyCoreFields-ajaxSelectPicker--open"),e(i).on("scroll.tify_fields.ajax_select."+t.instance.uuid,function(){var e=t._getPickerOffset();t.picker.css(e)})},_hidePicker:function(){e(i).off("scroll.tify_fields.ajax_select."+this.instance.uuid),this.picker.removeClass("tiFyCoreFields-ajaxSelectPicker--open")},_getPickerOffset:function(){var t=e.extend({},this.controller.offset(),{width:this.controller.outerWidth(!0)}),o=this.options.placement;switch(this.options.viewport.delta.top&&(t.top+=this.options.viewport.delta.top),this.options.viewport.delta.left&&(t.left+=this.options.viewport.delta.left),this.options.viewport.adminbar&&(t.top+=e("body").hasClass("admin-bar")?-e("#wpadminbar").outerHeight():0),"clever"===o&&(o=e(i).outerHeight()+e(i).scrollTop()<t.top+this.picker.outerHeight()?"top":"bottom"),this.picker.addClass("tiFyCoreFields-ajaxSelectPicker--"+o),o){case"top":t.top-=this.picker.outerHeight(!0);break;case"bottom":t.top+=this.controller.outerHeight(!0)}return t},enable:function(){this.controller.hasClass("tiFyCoreFields-ajaxSelectController--disabled")&&this._enable()},disable:function(){this.controller.hasClass("tiFyCoreFields-ajaxSelectController--disabled")||this._disable()},destroy:function(){this.el.remove(),this.picker.remove()},instance:function(){return void 0!==this.instance}}),e(".tiFyCoreFields-ajaxSelect").tiFyFieldsAjaxSelect()}(jQuery,document,window);