!function(e,t,i){var a=e.valHooks.div;e.valHooks.div={get:function(t){return void 0===e(t).tiFySelect("instance")?a&&a.get&&a.get(t)||void 0:e(t).data("value")},set:function(t,i){if(void 0===e(t).tiFySelect("instance"))return a&&a.set&&a.set(t,i)||void 0;e(t).data("value",i)}},e.widget("tify.tiFySelect",{options:{disabled:!1,multiple:!1,duplicate:!1,max:-1,trigger:{},picker:{},sortable:{},source:!1,autocomplete:!1},controllers:{handler:"tiFy-selectHandler",trigger:"tiFy-selectTrigger",autocompleteInput:"tiFy-selectAutocomplete",selectedList:"tiFy-selectSelectedItems",picker:"tiFy-selectPicker",pickerList:"tiFy-selectPickerItems",pickerFilter:"tiFy-selectPickerFilter",pickerLoader:"tiFy-selectPickerLoader"},_create:function(){this.instance=this,this.el=this.element,this._initOptions(),this._initControllers(),this._initStatusFlags(),this._initEvents()},_initOptions:function(){this.el.data("options")&&e.extend(this.options,e.parseJSON(decodeURIComponent(this.el.data("options")))),this.options.source?("object"!=typeof this.options.source&&(this.options.source={}),this.dataSource=this.options.source):this.dataSource=void 0},_initStatusFlags:function(){this.flags={isDisabled:!0,isMultiple:!1,isDuplicable:!1,isRemovable:!0,isSortable:!1,isOpen:!1,isComplete:!0,page:1,hasArrow:!0,hasFilter:!1,hasSource:!1,hasAutocomplete:!1},this.flags.Disabled=this.options.disabled,this.flags.isMultiple=this.options.multiple,this.flags.isDuplicable=this.options.duplicate&&this.flags.isMultiple,this.flags.isRemovable=!this.flags.Disabled,this.flags.isSortable=!1!==this.options.sortable&&this.flags.isMultiple&&!this.flags.Disabled,this.flags.isOpen=!1,this.flags.isComplete=!1,this.flags.page=1,this.flags.hasSource=void 0!==this.dataSource},_initControllers:function(){var t=this;e.each(this.controllers,function(i,a){t[i]=e("."+a,t.el)})},_initEvents:function(){var e=this;e._initTrigger(),e._initPicker(),e._initSelected(),this.flags.isMultiple?this.el.attr("aria-multiple",!0):this.el.attr("aria-multiple",!1),this.flags.isSortable?this.el.attr("aria-sortable",!0):this.el.attr("aria-sortable",!1),this.flags.isDuplicable?(this.el.attr("aria-duplicable",!0),this.picker.attr("aria-duplicable",!0)):(this.el.attr("aria-duplicable",!1),this.picker.attr("aria-duplicable",!1)),this.flags.Disabled?this._disable():this._enable()},_initTrigger:function(){var t=this;t.options.trigger=e.extend({arrow:!0},t.options.trigger),t.options.trigger.arrow?(t.flags.hasArrow=!0,t.trigger.attr("aria-arrow",!0)):(t.flags.hasArrow=!1,t.trigger.attr("aria-arrow",!1)),t.options.autocomplete&&("object"!=typeof t.options.autocomplete&&(t.options.autocomplete={}),t.flags.hasAutocomplete=!0,t.el.attr("aria-autocomplete",!0),t.flags.isMultiple&&t.selectedList.insertAfter(t.trigger),t.autocompleteInput=e('<input class="tiFy-selectAutocomplete" autocomplete="off"/>').prependTo(t.trigger))},_initPicker:function(){var t=this;t.options.picker=e.extend({placement:"clever",appendTo:"body",delta:{top:0,left:0,width:0},adminbar:!0,filter:!1},t.options.picker);var i=e(this.options.picker.appendTo);i.length||(i=e("body")),t.picker.appendTo(i),t.options.picker.filter&&(t.flags.hasFilter=!0,t.picker.attr("aria-filter",!0),t.pickerFilter=e('<input class="tiFy-selectPickerFilter" autocomplete="off"/>').prependTo(t.picker))},_initSelected:function(){var t=this;t.flags.isSortable?(t.options.sortable=e.extend({handle:'[aria-handle="sort"]',containment:"parent",update:function(){t._reset()}},t.options.sortable),t.sortable=t.selectedList.sortable(t.options.sortable),t.selectedList.disableSelection()):t.sortable=void 0,t._reset()},_open:function(){var e=this;if(!e.flags.isOpen){e.flags.isOpen=!0,e.el.attr("aria-open",!0),e.picker.attr("aria-open",!0);var t=e._getPickerOffset();e.picker.css(t),e._getPickerItems(),e._onOpen()}},_close:function(){var e=this;e.flags.isOpen&&(e.flags.isOpen=!1,e.el.attr("aria-open",!1),e.picker.attr("aria-open",!1),e._onClose())},_enable:function(){var e=this;e.flags.Disabled=!1,e.el.attr("aria-disabled",!1),e.handler.prop("disabled",!1),e._onEnable()},_disable:function(){var e=this;e.flags.Disabled=!0,e.el.attr("aria-disabled",!0),e.handler.prop("disabled",!0),e._onDisable()},_add:function(t){var i=this;!this.flags.isDuplicable&&e('> [data-value="'+t.value+'"]',i.selectedList).length?t.new=!1:(t.new=!0,i.flags.isMultiple||i._removeAll(),t.index=i._count(),e('<li data-label="'+t.label+'" data-value="'+t.value+'" data-index="'+t.index+'">'+(void 0!==t.select?t.select:t.label)+"</li>").appendTo(i.selectedList)),i._onAdd(t)},_remove:function(t){var i=this;i._get(t.index).remove(),e('> [data-index="'+t.index+'"]',i.handler).remove(),e('> [data-value="'+t.value+'"]',i.selectedList).length||e('> [data-value="'+t.value+'"]',i.pickerList).attr("aria-selected",!1),i._onRemove(t)},_get:function(t){return e('> li[data-index="'+t+'"]',this.selectedList)},_removeAll:function(){var t=this;t._all().each(function(){var i=t._getAttrs(e(this));t._get(i.index).remove(),e('> [data-index="'+i.index+'"]',t.handler).remove(),e('> [data-value="'+i.value+'"]',t.selectedList).length||e('> [data-value="'+i.value+'"]',t.pickerList).attr("aria-selected",!1)}),t.el.val(t.handler.val())},_reset:function(){var t=this;e("option",t.handler).remove(),t._all().each(function(){var i=t._getAttrs(e(this));t._setRemovable(i),t._setSortable(i),t._addHandler(i),t._setPicker(i)}),t.el.val(t.handler.val())},_all:function(){return e("> li",this.selectedList)},_count:function(){return this._all().length},_highlight:function(t){e('> [data-value="'+t.value+'"]',this.selectedList).attr("aria-highlight",!0).one("webkitAnimationEnd oanimationend msAnimationEnd animationend",function(){e(this).attr("aria-highlight",!1)})},_setRemovable:function(e){this.flags.isRemovable&&this._get(e.index).prepend('<span aria-handle="remove">Ã—</span>')},_setSortable:function(e){this.flags.isSortable&&(this.options.sortable.handle?this._get(e.index).prepend('<span aria-handle="sort">...</span>'):this._get(e.index).attr("aria-handle","sort"))},_onOpen:function(){var a=this;e(t).on("click.tify_select.outside"+a.instance.uuid,function(t){var i=!0;e.each(a.controllers,function(s,l){if(e(t.target).is(e("."+l,a.el)))return i=!1,!0}),i&&a._close()}),e(i).on("scroll.tify_select.picker_position."+a.instance.uuid,function(){var e=a._getPickerOffset();a.picker.css(e)}),a.pickerList.on("scroll.tify_select.picker_list."+a.instance.uuid,function(){e(this).prop("scrollHeight")-e(this).innerHeight()-e(this).scrollTop()<20&&a._getPickerItems()}),a.flags.hasFilter&&a.pickerFilter.on("keyup.tify_select.picker_filter."+a.instance.uuid,function(){var t=e(this).val();e("> li",a.pickerList).each(function(){var i=new RegExp(t,"i");e(this).data("label").match(i)?e(this).show():e(this).hide()})}),a.flags.hasFilter&&a.pickerFilter.focus()},_onClose:function(){var a=this;e(t).off("click.tify_select.outside"+a.instance.uuid),e(i).off("scroll.tify_select.picker_position."+a.instance.uuid),a.pickerList.off("scroll.tify_select.picker_list."+a.instance.uuid),a.flags.hasFilter&&a.pickerFilter.off("keyup.tify_select.picker_filter."+a.instance.uuid)},_onEnable:function(){var t=this;t.trigger.on("click.tify_select.open."+t.instance.uuid,function(){t.flags.isOpen?t._close():t._open()}),e("> li",t.pickerList).on("click.tify_select.picker_item_select."+t.instance.uuid,function(){var i=t._getAttrs(e(this));t._add(i)}),t.flags.isRemovable&&e('> li > [aria-handle="remove"]',t.selectedList).on("click.tify_select.selected_remove."+t.instance.uuid,function(){var i=t._getAttrs(e(this).closest("li"));t._remove(i)}),this._count()||this.selectedList.hide(),t.flags.hasAutocomplete&&t.autocompleteInput.on("keyup.tify_select.autocomplete."+t.instance.uuid,function(){t._close(),e(this).val()&&(t.pickerList.empty(),t.flags.isComplete=!1,t.flags.page=1,void 0!==t.timeout&&clearTimeout(t.timeout),void 0!==t.xhr&&t.xhr.abort(),t.timeout=setTimeout(function(){t._getPickerItems(),t.xhr.done(function(e){e.length&&t._open()})},1e3))})},_onDisable:function(){var t=this;t.trigger.off("click.tify_select.open."+t.instance.uuid),e("> li",t.pickerList).on("click.tify_select.picker_item_select."+t.instance.uuid),t.flags.isRemovable&&e('> li > [aria-handle="remove"]',t.selectedList).off("click.tify_select.selected_remove."+t.instance.uuid),t.flags.hasAutocomplete&&t.autocompleteInput.off("keyup.tify_select.autocomplete."+t.instance.uuid)},_onAdd:function(t){var i=this;t.new&&(i._setRemovable(t),i.flags.isRemovable&&e('> [aria-handle="remove"]',i._get(t.index)).on("click.tify_select.selected_remove."+i.instance.uuid,function(){i._remove(t)}),i._setSortable(t),i._setPicker(t),i._addHandler(t)),i.selectedList.show(),i._close(),i._highlight(t),i.el.val(i.handler.val()),i.el.trigger("tify_select.add")},_onRemove:function(e){this._count()||this.selectedList.hide(),this.el.val(this.handler.val()),this.el.trigger("tify_select.remove")},_getAttrs:function(e){return{label:e.data("label"),value:e.data("value"),index:e.data("index"),picker:e.data("picker")?e.data("picker"):e.data("label"),select:e.data("select")?e.data("select"):e.data("label")}},_addPicker:function(t){var i=this;e('> [data-value="'+t.value+'"]',i.pickerList).length||(e('<li data-label="'+t.label+'" data-value="'+t.value+'" data-index="'+t.value+'" >'+(void 0!==t.picker?t.picker:t.label)+"</li>").appendTo(i.pickerList).on("click.tify_select.picker_item_select."+i.instance.uuid,function(){i._add(t)}),i._setPicker(t))},_setPicker:function(t){e('> [data-value="'+t.value+'"]',this.selectedList).length?e('> [data-value="'+t.value+'"]',this.pickerList).attr("aria-selected",!0):e('> [data-value="'+t.value+'"]',this.pickerList).attr("aria-selected",!1)},_queryPickerArgs:function(){var e={page:this.flags.page};return this.flags.hasAutocomplete&&(e.term=this.autocompleteInput.val()),e},_getPickerItems:function(){var t=this;t.flags.isComplete||this.flags.hasSource&&(t.pickerLoader.show(),t.xhr=e.ajax({url:tify_ajaxurl,data:e.extend(t.dataSource,t._queryPickerArgs()),method:"POST"}).done(function(i){i.length?(e.each(i,function(e,i){t._addPicker(i)}),t.flags.page++):(t.flags.isComplete=!0,t.flags.page=1)}).always(function(){t.pickerLoader.hide()}))},_getPickerOffset:function(){var t=this,a=e.extend({},t.trigger.offset(),{width:t.trigger.outerWidth()}),s=t.options.picker.placement;switch(t.options.picker.delta.top&&(a.top+=t.options.picker.delta.top),t.options.picker.delta.left&&(a.left+=t.options.picker.delta.left),t.options.picker.delta.width&&(a.width+=t.options.picker.delta.width),t.options.picker.adminbar&&(a.top+=e("body").hasClass("admin-bar")?-e("#wpadminbar").outerHeight():0),"clever"===s&&(s=e(i).outerHeight()+e(i).scrollTop()<a.top+t.picker.outerHeight()?"top":"bottom"),s){case"top":a.top-=t.picker.outerHeight()-1;break;case"bottom":a.top+=t.trigger.outerHeight()-1}return a},_addHandler:function(t){e('[data-index="'+t.index+'"]',this.handler).length||e('<option value="'+t.value+'" data-index="'+t.index+'" selected>'+t.label+"</option>").appendTo(this.handler)},sortable:function(){if(this.flags.isSortable)return this.sortable},open:function(){this.flags.Disabled||this._open()},close:function(){this.flags.Disabled||this._close()},enable:function(){this.flags.Disabled&&this._enable()},disable:function(){this.flags.Disabled||this._disable()},destroy:function(){this.el.remove(),this.picker.remove()}})}(jQuery,document,window);